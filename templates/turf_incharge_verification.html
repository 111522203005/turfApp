<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Turf Incharge Verification</title>
    <script src="https://cdn.rawgit.com/lindell/JsQR/master/dist/jsQR.js"></script>
</head>
<body>
    <h2>Turf Incharge Verification</h2>
    <video id="qr-video" width="100%" height="100%"></video>
    <div id="qr-result"></div>

    <script>
        const video = document.getElementById('qr-video');
        const resultContainer = document.getElementById('qr-result');

        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then((stream) => {
                video.srcObject = stream;
                video.setAttribute('playsinline', true); // required to tell iOS safari we don't want fullscreen
                video.play();
                requestAnimationFrame(tick);
            });

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                const canvasElement = document.createElement('canvas');
                canvasElement.width = video.videoWidth;
                canvasElement.height = video.videoHeight;
                const canvas = canvasElement.getContext('2d');
                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                const imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height, {
                    inversionAttempts: 'dontInvert',
                });

                if (code) {
                    resultContainer.textContent = `Scanned QR code: ${code.data}`;
                    // Send the scanned code to the server for verification
                    // You may use AJAX or form submission for this part
                    window.location.href = `/verify_booking/${code.data}/`;
                }

                requestAnimationFrame(tick);
            }
        }
    </script>
</body>
</html>